---
title: "Map Test: Park Access"
description: |
  Access to parks in Los Angeles County (excerpt from African American Data Pullout).
author:
  - name: Catalyst California
    url: catalystcalifornia.org
date: 2024-01-23
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(comment=FALSE, message=FALSE, warning=FALSE, echo=FALSE
)

library(dplyr)
library(broom)
library(stringr)
library(RPostgreSQL)
library(tidyr)
library(scales)
library(knitr)
library(data.table)
library(sp)
library(sf)
library(rgdal)
library(rpostgis)
library(readxl)
library(showtext)
library(leaflet)
library(leaflet.extras)
library(htmltools)
library(geojsonsf)
library(rmapshaper)
library(tigris)


# Data Setup
source("W:\\RDA Team\\R\\credentials_source.R")

con <- connect_to_db("f5la_v2")

```

Parks are another important aspect to a healthy built environment for children and families, as they promote active lifestyles and allow for more outdoor activities. The importance of green space increased during the pandemic, when outdoor spaces became the only way for children and families to safely gather. It isn’t surprising that a survey conducted by Community Coalition found the need for more park space to be a top priority amongst South Los Angeles residents. Using funding from First 5 LA, Community Coalition is working on a new park project in Broadway/Manchester to respond to the community’s need.

Access to green space for families is disparate between where predominantly white families live versus families of color. The map below shows the results of a countywide parks needs assessment that was conducted in 2016. For this assessment, park need was defined by analyzing five park metrics:

How much park land is there in acres?
How much land is available to residents in the area and around each park?
What is the condition of the park?
How much of the population has access to parks?
What park amenities are available?
Areas with a High and Very High park need are located in the South LA area, where a high concentration of Black families live, and the San Fernando Valley area. Detailed methodology for the data behind this map can be found here.

To explore the data further, click on each census tract on the map. You can also view the high black population census tracts, or the Best Start Geography boundaries, by clicking on the boxes in the top right corner of the map. Higher black population tracts are defined as census tracts with a black population of at least 10%.

```{r}


# read in parks,  black pop data and bsc data

park<-st_read(con, query="SELECT* FROM la_county_park_need_2016", geom="geom")

pop<-st_read(con, query="SELECT pop.*,ct.geom
FROM ct_lac ct
LEFT JOIN black_pop_by_ct pop ON pop.geoid=ct.geoid
WHERE pct_nh_black_pop >=10",
               geom="geom")

bsc<-st_read(con, query="SELECT * FROM f5la_best_start_geographies", geom=
               "geom")

# transform 
park<-st_transform(park, 4326)
pop<-st_transform(pop, 4326)
bsc<-st_transform(bsc, 4326)

# set the description column as factor to customize the order

park <- within(park, category <- factor(need_descp, levels=c("Very Low","Low", "Moderate", "High", "Very High", "Not Participating")))

park$need_descp <- factor(park$need_descp, levels=c("Very Low","Low", "Moderate", "High", "Very High", "Not Participating"))



# pop ups

popup_pop<-paste0(label = paste0("<span style='font-size: 14px; font-weight: bold'>","Census Tract: ",htmlEscape(pop$geoid),"</span></br>",
 "Percent Black Population: ","<span style= 'font-weight: bold'>",pop$pct_black_aoic_pop,"%","</span></br>",
 "Total Black Population: ", "<span style= 'font-weight: bold'>",scales::comma(pop$black_aoic_pop, big.mark = ",", accuracy=1),"</span>"))


popup_park<-paste0(label = paste0("<span style='font-size: 14px; font-weight: bold'>",park$stud_ar_nm,"</span></br>",
                                "Supervisorial District: ","<span style= 'font-weight: bold'>",park$district,"</span></br>",
                                "Park Need: ","<span style= 'font-weight: bold'>",park$need_descp,"</span></br>"))

#palette

pal<-colorFactor(c("#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3","#493870", "#aaaaaa"), park$need_descp) 

# map

leaflet() %>%
  addMapPane("park_pane", zIndex=489)%>%
  addMapPane("race_pane", zIndex=489)%>%
    addMapPane("bsc_pane", zIndex=489)%>%


  addPolygons(data = park, 
              color = "white", weight = 1, smoothFactor = 0.5, opacity = 1,
               highlight=highlightOptions(color= "white", stroke =1.5, weight = 3, bringToFront = FALSE),
              fillOpacity = 1,
              fillColor = ~pal(park$need_descp),
              popup = ~paste0(popup_park),
              options = pathOptions(pane = "park_pane")) %>%
  
#census tracts with high black population layer
  addPolygons(data=pop, 
              color="#FBF636", 
              weight = 1, smoothFactor = 0.5,
              opacity = 1, fillOpacity = 0, group="High Black Population Census Tracts",
                popup = popup_pop,
              highlight=highlightOptions(color= "#FBF636", stroke =1.5, weight = 3, bringToFront = FALSE),  
              options = pathOptions(pane = "race_pane")
             )%>%
  
  #bsc layer
  
  addPolygons(data=bsc, color="black", weight=1.5, opacity = 1, fill=F,
              group="Best Start Geography",
              options = pathOptions(pane = "bsc_pane")) %>%
  
  
   #base and view
 addProviderTiles("CartoDB.PositronNoLabels")%>%
  addProviderTiles("CartoDB.PositronOnlyLabels", 
                   options = providerTileOptions(pane = "markerPane"),
                   group = "map labels")%>%
  
  
  setView(	-118.205914, 	34.187684	, zoom = 9) %>%
  
   #layer control
    addLayersControl(overlayGroups =
                       c("Best Start Geography", "High Black Population Census Tracts"), 
                  options = layersControlOptions(collapsed = FALSE))%>%
  
  #hide race outline first
  
  hideGroup("High Black Population Census Tracts")%>%
  
  #hide bsc layer
  
    hideGroup("Best Start Geography")%>%

  #legend


addLegend(position = "bottomleft", pal = pal, values = park$need_descp, opacity = 1, 
          title = "Park Need")%>%
    addFullscreenControl()





```


